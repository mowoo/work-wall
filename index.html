<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„é›²ç«¯å·¥ä½œç‰† (v6.2 å®‰å…¨åˆ†æµç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script src="config.js"></script>

    <style>
        /* ... (ä¿ç•™åŸæœ¬ v6.1 çš„ CSSï¼Œå®Œå…¨ä¸ç”¨å‹•ï¼Œç‚ºäº†ç¯‡å¹…æˆ‘é€™è£¡çœç•¥ CSS å€å¡Š) ... */
        /* è«‹å°‡ v6.1 çš„ CSS è²¼åœ¨é€™è£¡ */
        :root { --bg-color: #000000; --text-color: #f5f5f7; --glass-bg: rgba(28, 28, 30, 0.65); --glass-border: rgba(255, 255, 255, 0.1); --accent-red: #ff453a; --accent-orange: #ff9f0a; --accent-green: #30d158; --accent-archive: #78909c; --accent-inbox: #bf5af2; --card-bg: rgba(60, 60, 65, 0.7); }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); background-image: radial-gradient(at 0% 0%, rgba(50, 50, 60, 0.5) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(20, 20, 25, 0.5) 0px, transparent 50%); color: var(--text-color); margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .toolbar { padding: 8px 20px; display: flex; align-items: center; justify-content: space-between; background: rgba(0, 0, 0, 0.2); backdrop-filter: blur(10px); border-bottom: 1px solid var(--glass-border); flex-shrink: 0; }
        h1 { margin: 0; font-size: 1rem; font-weight: 600; opacity: 0.9; }
        .connection-status { font-size: 0.75rem; display: flex; align-items: center; gap: 6px; color: #888; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: #ff453a; transition: background-color 0.3s; }
        .inbox-section { flex-shrink: 0; margin: 10px 20px 0 20px; padding: 8px; background: rgba(191, 90, 242, 0.1); border: 1px dashed var(--accent-inbox); border-radius: 10px; display: flex; align-items: center; gap: 10px; height: 70px; }
        .inbox-header { display: flex; flex-direction: column; justify-content: center; min-width: 100px; border-right: 1px solid rgba(255,255,255,0.1); padding-right: 10px; }
        .inbox-title { color: var(--accent-inbox); font-weight: bold; font-size: 0.9rem; }
        .inbox-input { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; padding: 4px 8px; color: white; font-size: 0.85rem; outline: none; width: 100%; margin-top: 4px; }
        .inbox-list { flex-grow: 1; display: flex; flex-direction: row; gap: 8px; overflow-x: auto; overflow-y: hidden; height: 100%; align-items: center; padding-right: 5px; scrollbar-width: thin; }
        .inbox-list .note { min-width: 200px; max-width: 200px; margin-bottom: 0; flex-shrink: 0; }
        .board { flex-grow: 1; display: flex; gap: 12px; overflow-x: auto; padding: 15px; height: 100%; box-sizing: border-box; }
        .column { flex: 0 0 300px; max-width: 300px; background-color: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 10px; display: flex; flex-direction: column; max-height: 100%; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); backdrop-filter: blur(20px); overflow: hidden; }
        .column-header { padding: 10px 12px; font-weight: 600; font-size: 0.9rem; display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); }
        #col-urgent { border-top: 3px solid var(--accent-red); } #col-urgent .column-header { color: var(--accent-red); background: linear-gradient(to bottom, rgba(255, 69, 58, 0.1), transparent); }
        #col-next-week { border-top: 3px solid var(--accent-orange); } #col-next-week .column-header { color: var(--accent-orange); background: linear-gradient(to bottom, rgba(255, 159, 10, 0.1), transparent); }
        #col-long-term { border-top: 3px solid var(--accent-green); } #col-long-term .column-header { color: var(--accent-green); background: linear-gradient(to bottom, rgba(48, 209, 88, 0.1), transparent); }
        #col-archive { border-top: 3px solid var(--accent-archive); } #col-archive .column-header { color: var(--accent-archive); background: linear-gradient(to bottom, rgba(120, 144, 156, 0.1), transparent); }
        .note-list { flex-grow: 1; overflow-y: auto; padding: 8px; min-height: 80px; scrollbar-width: thin; }
        .review-zone { flex-shrink: 0; min-height: 80px; max-height: 40%; display: flex; flex-direction: column; background: rgba(0, 0, 0, 0.3); border-top: 2px solid rgba(255, 255, 255, 0.1); }
        .review-header { font-size: 0.7rem; color: rgba(255,255,255,0.5); padding: 6px 10px; font-weight: bold; background: rgba(255,255,255,0.03); }
        .review-list { padding: 6px 10px; overflow-y: auto; flex-grow: 1; }
        .note { background-color: var(--card-bg); padding: 10px; margin-bottom: 8px; border-radius: 6px; border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 1px 3px rgba(0,0,0,0.2); cursor: grab; position: relative; transition: all 0.2s ease; animation: fadeIn 0.3s ease; display: flex; flex-direction: column; gap: 4px; border-left: 3px solid transparent; }
        .note:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.4); border-color: rgba(255, 255, 255, 0.2); z-index: 10; } .note:active { cursor: grabbing; }
        .note-content { outline: none; word-break: break-word; font-size: 0.9rem; line-height: 1.4; padding-right: 15px; }
        .tools { position: absolute; top: 4px; right: 4px; display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; background: rgba(0,0,0,0.5); border-radius: 4px; padding: 2px; } .note:hover .tools { opacity: 1; }
        .tool-icon { cursor: pointer; width: 18px; height: 18px; text-align: center; line-height: 18px; border-radius: 3px; font-size: 12px; color: #ddd; } .tool-icon:hover { background: rgba(255,255,255,0.3); color: white; } .delete-icon:hover { background: rgba(255, 69, 58, 0.8); }
        .note-meta { display: none; align-items: center; justify-content: flex-start; gap: 8px; font-size: 0.75rem; color: #aaa; margin-top: 4px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 4px; } .note-meta.has-content { display: flex; }
        .date-badge { background: rgba(255,255,255,0.1); padding: 1px 5px; border-radius: 3px; display: none; font-size: 0.7rem; } .date-badge.active { display: inline-block; } .date-badge.urgent { background: rgba(255, 159, 10, 0.3); color: #ffbc5e; } .date-badge.overdue { background: rgba(255, 69, 58, 0.3); color: #ff8a84; }
        .link-btn { text-decoration: none; color: #64d2ff; cursor: pointer; display: none; align-items: center; gap: 4px; } .link-btn.active { display: flex; } .link-btn:hover { text-decoration: underline; }
        .settings-panel { display: none; background: rgba(0,0,0,0.5); padding: 8px; border-radius: 4px; margin-top: 4px; font-size: 0.8rem; border: 1px solid rgba(255,255,255,0.1); } .settings-panel.open { display: block; }
        .settings-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; } .settings-row:last-child { margin-bottom: 0; }
        input[type="date"] { background: rgba(255,255,255,0.1); border: none; color: white; padding: 2px; border-radius: 3px; font-size: 0.8rem; }
        .color-dots { display: flex; gap: 4px; } .color-dot { width: 14px; height: 14px; border-radius: 50%; cursor: pointer; border: 1px solid transparent; } .color-dot.selected { border-color: white; }
        #review-urgent .note { background-color: var(--dark-red-bg); border-color: var(--dark-red-border); } #review-next .note { background-color: var(--dark-orange-bg); border-color: var(--dark-orange-border); } #review-long .note { background-color: var(--dark-green-bg); border-color: var(--dark-green-border); } #review-archive .note { background-color: var(--dark-archive-bg); border-color: var(--dark-archive-border); }
        .list-footer { padding: 8px; border-top: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.25); flex-shrink: 0; } .new-card-input { flex-grow: 1; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; padding: 6px 8px; color: white; outline: none; font-size: 0.85rem;} .mini-btn { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); border-radius: 6px; cursor: pointer; padding: 0 8px; margin-left: 6px;}
    </style>
</head>
<body>

    <div class="toolbar">
        <h1>é›²ç«¯å·¥ä½œç‰† <span style="font-size:0.7em; opacity:0.6; font-weight:normal;" id="version-tag">v6.2 Secure</span></h1>
        <div class="connection-status"><div id="status-dot" class="status-dot"></div><span id="status-text">åˆå§‹åŒ–...</span></div>
    </div>

    <div class="inbox-section">
        <div class="inbox-header">
            <div class="inbox-title">ğŸ“¥ æ”¶é›†ç®±</div>
            <input type="text" class="inbox-input" id="input-inbox" placeholder="æŒ‰ Enter æ–°å¢..." onkeypress="handleInputKey(event, 'inbox-list', this)">
        </div>
        <div class="note-list inbox-list" id="inbox-list"></div>
    </div>

    <div class="board">
        <div class="column" id="col-urgent">
            <div class="column-header"><span contenteditable="true" class="list-title" id="title-urgent">ğŸ”¥ æ¥µé‡è¦</span></div>
            <div class="note-list" id="urgent-list"></div>
            <div class="review-zone">
                <div class="review-header">æš«æ”¾ / å¯©æ ¸</div>
                <div class="note-list review-list" id="review-urgent"></div>
            </div>
            <div class="list-footer"><div style="display:flex"><input type="text" class="new-card-input" id="input-urgent" placeholder="æ–°å¢..." onkeypress="handleInputKey(event, 'urgent-list', this)"><button class="mini-btn" onclick="addCardFromInput('urgent-list', 'input-urgent')">ï¼‹</button></div></div>
        </div>
        <div class="column" id="col-next-week">
            <div class="column-header"><span contenteditable="true" class="list-title" id="title-next">ğŸ“… ä¸‹å‘¨äº‹é …</span></div>
            <div class="note-list" id="next-week-list"></div>
            <div class="review-zone">
                <div class="review-header">æš«æ”¾ / å¯©æ ¸</div>
                <div class="note-list review-list" id="review-next"></div>
            </div>
            <div class="list-footer"><div style="display:flex"><input type="text" class="new-card-input" id="input-next" placeholder="æ–°å¢..." onkeypress="handleInputKey(event, 'next-week-list', this)"><button class="mini-btn" onclick="addCardFromInput('next-week-list', 'input-next')">ï¼‹</button></div></div>
        </div>
        <div class="column" id="col-long-term">
            <div class="column-header"><span contenteditable="true" class="list-title" id="title-long">ğŸš€ é•·æœŸè¦åŠƒ</span></div>
            <div class="note-list" id="long-term-list"></div>
            <div class="review-zone">
                <div class="review-header">æš«æ”¾ / æš«ä¸€æ®µè½</div>
                <div class="note-list review-list" id="review-long"></div>
            </div>
            <div class="list-footer"><div style="display:flex"><input type="text" class="new-card-input" id="input-long" placeholder="æ–°å¢..." onkeypress="handleInputKey(event, 'long-term-list', this)"><button class="mini-btn" onclick="addCardFromInput('long-term-list', 'input-long')">ï¼‹</button></div></div>
        </div>
        <div class="column" id="col-archive">
            <div class="column-header"><span contenteditable="true" class="list-title" id="title-archive">ğŸ“¦ å·²å®Œæˆ</span></div>
            <div class="note-list" id="archive-list"></div>
            <div class="review-zone">
                <div class="review-header">æ­·å²æ­¸æª”</div>
                <div class="note-list review-list" id="review-archive"></div>
            </div>
            <div class="list-footer"><div style="display:flex"><input type="text" class="new-card-input" id="input-archive" placeholder="æ–°å¢..." onkeypress="handleInputKey(event, 'archive-list', this)"><button class="mini-btn" onclick="addCardFromInput('archive-list', 'input-archive')">ï¼‹</button></div></div>
        </div>
    </div>

    <script>
        let db; let dbRef; let isConnected = false;
        // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œç„¡è³‡æ–™åº«æ¼”ç¤ºæ¨¡å¼ã€
        let isDemoMode = false;

        document.addEventListener('DOMContentLoaded', () => {
            // å®‰å…¨æª¢æŸ¥ï¼šconfig.js æ˜¯å¦å­˜åœ¨ä¸”æœ‰å…§å®¹
            if (typeof firebaseConfig === 'undefined' || !firebaseConfig.apiKey) {
                initDemoMode();
            } else {
                initFirebase();
            }

            // UI ç¶å®š
            document.querySelectorAll('.list-title').forEach(el => el.addEventListener('input', debounceSave));
            setupDragAndDrop();
        });

        function initDemoMode() {
            isDemoMode = true;
            document.getElementById('status-dot').style.backgroundColor = '#aaa';
            document.getElementById('status-text').innerText = 'å…¬é–‹æ¼”ç¤ºæ¨¡å¼ (ç„¡å„²å­˜)';
            document.getElementById('version-tag').innerText = 'v6.2 Demo';
            console.log("é€²å…¥æ¼”ç¤ºæ¨¡å¼ï¼šè³‡æ–™ä¸æœƒä¸Šå‚³");
        }

        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                dbRef = db.ref('workBoardData');
                db.ref(".info/connected").on("value", (snap) => {
                    document.getElementById('status-dot').style.backgroundColor = snap.val() ? '#30d158' : '#ff453a';
                    document.getElementById('status-text').innerText = snap.val() ? 'å·²é€£ç·š (ç§æœ‰)' : 'é›¢ç·š';
                });
                dbRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) renderBoard(data);
                    else saveDataToCloud();
                });
            } catch (error) {
                console.error("Firebase Error", error);
                alert("Firebase è¨­å®šæœ‰èª¤ï¼Œåˆ‡æ›è‡³é›¢ç·šæ¨¡å¼");
                initDemoMode();
            }
        }

        // çµ±ä¸€å­˜æª”å…¥å£
        function saveDataToCloud() {
            if (isDemoMode) {
                console.log("æ¼”ç¤ºæ¨¡å¼ï¼šç•¥éå­˜æª”");
                return; 
            }
            if (!dbRef) return;
            const data = {
                inbox: getListContent('inbox-list'),
                urgent: getListContent('urgent-list'), nextWeek: getListContent('next-week-list'),
                longTerm: getListContent('long-term-list'), archive: getListContent('archive-list'),
                reviewUrgent: getListContent('review-urgent'), reviewNext: getListContent('review-next'),
                reviewLong: getListContent('review-long'), reviewArchive: getListContent('review-archive'),
                titles: {
                    urgent: document.getElementById('title-urgent').innerText,
                    nextWeek: document.getElementById('title-next').innerText,
                    longTerm: document.getElementById('title-long').innerText,
                    archive: document.getElementById('title-archive').innerText
                },
                lastUpdated: Date.now()
            };
            dbRef.set(data).catch(e => console.error(e));
        }

        // --- ä»¥ä¸‹é‚è¼¯èˆ‡ v6.1 å®Œå…¨ç›¸åŒï¼Œä½†ç‚ºæ±‚å®Œæ•´ä¸€ä½µé™„ä¸Š ---
        
        function renderBoard(data) {
            const map = {
                'inbox-list': data.inbox, 'urgent-list': data.urgent, 'next-week-list': data.nextWeek,
                'long-term-list': data.longTerm, 'archive-list': data.archive,
                'review-urgent': data.reviewUrgent, 'review-next': data.reviewNext,
                'review-long': data.reviewLong, 'review-archive': data.reviewArchive
            };
            const activeEl = document.activeElement;
            const isEditing = activeEl && (activeEl.classList.contains('note-content') || activeEl.tagName === 'INPUT');
            if(!isEditing) {
                for (const [listId, notes] of Object.entries(map)) {
                    const list = document.getElementById(listId);
                    if(list) {
                        list.innerHTML = '';
                        if (notes) notes.forEach(n => list.appendChild(createNoteElement(n)));
                    }
                }
                if(data.titles) {
                    document.getElementById('title-urgent').innerText = data.titles.urgent;
                    document.getElementById('title-next').innerText = data.titles.nextWeek;
                    document.getElementById('title-long').innerText = data.titles.longTerm;
                    document.getElementById('title-archive').innerText = data.titles.archive;
                }
            }
        }

        function createNoteElement(data) {
            const noteData = (typeof data === 'string') ? { text: data, id: 'note-'+Date.now() } : data;
            const note = document.createElement('div');
            note.classList.add('note'); note.setAttribute('draggable', 'true'); note.id = noteData.id;
            if (noteData.tagColor) note.style.borderLeftColor = noteData.tagColor;

            const content = document.createElement('div');
            content.classList.add('note-content'); content.contentEditable = 'true'; content.innerText = noteData.text;
            
            const tools = document.createElement('div'); tools.classList.add('tools');
            const settingsBtn = document.createElement('div'); settingsBtn.classList.add('tool-icon'); settingsBtn.innerText = 'âš™ï¸';
            settingsBtn.onclick = (e) => { e.stopPropagation(); toggleSettings(note); };
            const delBtn = document.createElement('div'); delBtn.classList.add('tool-icon', 'delete-icon'); delBtn.innerText = 'âœ•';
            delBtn.onclick = (e) => { e.stopPropagation(); if(confirm('åˆªé™¤ï¼Ÿ')) { note.remove(); saveDataToCloud(); } };
            tools.appendChild(settingsBtn); tools.appendChild(delBtn);

            const meta = document.createElement('div'); meta.classList.add('note-meta');
            const linkBtn = document.createElement('a'); linkBtn.classList.add('link-btn'); linkBtn.target = "_blank"; linkBtn.innerHTML = '<span>ğŸ”—</span>é€£çµ';
            meta.appendChild(linkBtn);
            const dateBadge = document.createElement('span'); dateBadge.classList.add('date-badge'); meta.appendChild(dateBadge);

            const checkMetaVisibility = () => {
                const hasLink = updateLinkButton(note, content.innerText);
                const hasDate = noteData.dueDate && noteData.dueDate !== '';
                if(hasDate) updateDateDisplay(dateBadge, noteData.dueDate);
                if (hasLink || hasDate) meta.classList.add('has-content'); else meta.classList.remove('has-content');
            };
            content.addEventListener('input', () => { checkMetaVisibility(); debounceSave(); });
            setTimeout(() => checkMetaVisibility(), 0);

            const settingsPanel = document.createElement('div'); settingsPanel.classList.add('settings-panel');
            const dateRow = document.createElement('div'); dateRow.classList.add('settings-row');
            const dateInput = document.createElement('input'); dateInput.type = 'date';
            if(noteData.dueDate) dateInput.value = noteData.dueDate;
            dateInput.addEventListener('change', () => { noteData.dueDate = dateInput.value; checkMetaVisibility(); saveDataToCloud(); });
            dateRow.innerHTML = '<span>åˆ°æœŸæ—¥:</span>'; dateRow.appendChild(dateInput);

            const colorRow = document.createElement('div'); colorRow.classList.add('settings-row'); colorRow.innerHTML = '<span>æ¨™ç±¤:</span>';
            const colorsDiv = document.createElement('div'); colorsDiv.classList.add('color-dots');
            const colors = ['#ff453a', '#0a84ff', '#30d158', '#ffd60a', '#bf5af2', 'transparent'];
            colors.forEach(c => {
                const dot = document.createElement('div'); dot.classList.add('color-dot');
                dot.style.backgroundColor = c === 'transparent' ? '#333' : c;
                dot.onclick = () => { note.style.borderLeftColor = c; saveDataToCloud(); };
                colorsDiv.appendChild(dot);
            });
            colorRow.appendChild(colorsDiv);
            settingsPanel.appendChild(dateRow); settingsPanel.appendChild(colorRow);

            note.appendChild(tools); note.appendChild(content); note.appendChild(meta); note.appendChild(settingsPanel);
            note.addEventListener('dragstart', () => note.classList.add('dragging'));
            note.addEventListener('dragend', () => { note.classList.remove('dragging'); saveDataToCloud(); });
            return note;
        }

        function updateDateDisplay(badge, dateStr) {
            if (!dateStr) { badge.classList.remove('active'); return; }
            const due = new Date(dateStr); const now = new Date();
            const diffDays = Math.ceil((due - now) / (1000 * 60 * 60 * 24)); 
            badge.classList.add('active'); badge.classList.remove('urgent', 'overdue');
            if (diffDays < 0) { badge.innerText = `é€¾æœŸ ${Math.abs(diffDays)}å¤©`; badge.classList.add('overdue'); }
            else if (diffDays === 0) { badge.innerText = 'ä»Šå¤©'; badge.classList.add('urgent'); }
            else if (diffDays <= 2) { badge.innerText = `å‰© ${diffDays}å¤©`; badge.classList.add('urgent'); }
            else { badge.innerText = `${dateStr.slice(5)}`; }
        }

        function updateLinkButton(note, text) {
            const linkBtn = note.querySelector('.link-btn');
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const match = text.match(urlRegex);
            if (match) { linkBtn.href = match[0]; linkBtn.classList.add('active'); return true; }
            else { linkBtn.classList.remove('active'); return false; }
        }
        function toggleSettings(note) {
            const panel = note.querySelector('.settings-panel'); const isOpen = panel.classList.contains('open');
            document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('open'));
            if (!isOpen) panel.classList.add('open');
        }
        function addCardFromInput(listId, inputId) {
            const input = document.getElementById(inputId); const text = input.value.trim(); if (!text) return;
            const list = document.getElementById(listId);
            const newNoteData = { text: text, id: 'note-'+Date.now(), dueDate: '', tagColor: '' };
            list.appendChild(createNoteElement(newNoteData));
            if(listId === 'inbox-list') list.scrollLeft = list.scrollWidth; else list.scrollTop = list.scrollHeight;
            input.value = ''; input.focus(); saveDataToCloud();
        }
        function handleInputKey(e, l, i) { if (e.key === 'Enter') addCardFromInput(l, i.id); }
        function getListContent(listId) {
            const list = document.getElementById(listId); if (!list) return [];
            return [...list.querySelectorAll('.note')].map(note => ({
                id: note.id,
                text: note.querySelector('.note-content').innerText,
                tagColor: note.style.borderLeftColor || '',
                dueDate: note.querySelector('input[type="date"]').value || ''
            }));
        }
        let saveTimer; function debounceSave() { clearTimeout(saveTimer); saveTimer = setTimeout(saveDataToCloud, 800); }
        function setupDragAndDrop() {
            document.querySelectorAll('.note-list').forEach(list => {
                list.addEventListener('dragover', e => {
                    e.preventDefault();
                    const isHorizontal = list.id === 'inbox-list';
                    const afterElement = getDragAfterElement(list, isHorizontal ? e.clientX : e.clientY, isHorizontal);
                    const draggable = document.querySelector('.dragging');
                    if(draggable) { if (afterElement == null) list.appendChild(draggable); else list.insertBefore(draggable, afterElement); }
                });
            });
        }
        function getDragAfterElement(container, pos, isHorizontal) {
            const draggableElements = [...container.querySelectorAll('.note:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const boxCenter = isHorizontal ? box.left + box.width / 2 : box.top + box.height / 2;
                const offset = pos - boxCenter;
                if (offset < 0 && offset > closest.offset) return { offset: offset, element: child }; else return closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
    </script>
</body>
</html>
